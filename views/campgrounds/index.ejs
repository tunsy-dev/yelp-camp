<% layout('/layouts/boilerplate')%>

<div id="cluster-map"></div>

<div id="container" class="container">
    <div class="col-md-6 mx-auto mt-3">
        <h2 class="heading">All Campgrounds </h2>
        


    </div>
        <div class="col-sm-6 offset-sm-3 text-center">
            <form action="/campgrounds" method="GET" class="form-inline">
                <div class="input-group flex-fill">
                    <input type="text" name="search" placeholder="Campground search....." class="form-control input-sm">
                    <div class="input-group-append">
                        <input type="submit" value="Search" class="btn btn-secondary">
                    </div>
                </div>
            </form>
            <br>
            <a href="/campgrounds/new" class="btn btn-secondary col-md-6 mx-auto">Add New Campground</a>
            <br>
            <br>
        </div>
<!-- No search match -->
        <div class="row text-center">
            <div class="col-mb-6">
                <% if(noMatch !==null) { %>
                    <h4>
                        <%= noMatch %>
                    </h4>
                    <% } else if (search ==false) { %>
                            <h4></h4>
                            <% } else {%>  
                   <h4>Displaying search results for <%= search %> </h4>     
                   <% } %> 
                   <% if(noMatch !==null) { %>
                    <h4></h4>
                    <% } else {%>  
                                <h4 class="heading">Page Number <%= Number(current) %> of <%= pages + 1 %></h4>  
                        <% } %> 
            </div>
        </div>
<!-- Campgrounds Display -->
        <% for (let campground of campgrounds){%>
            <div class="card mb-3">
                <div class="row">
                    <div class="col-md-4">
                        <%if(campground.images.length) {%>
                         
                            <img class="img-fluid" src="<%= campground.images[0].url %>">
                        
                            <% }else { %>
                                <img class="img-fluid"
                                    src="https://res.cloudinary.com/tomscloudnamez/image/upload/v1606253297/YelpCamp/letcubmkbsfcvkn0md3r.jpg">
                                <% } %>
                    </div>
                    <div class="col-md-8">
                        <div class="card-body">
                            <h5 class="card-title">
                                <%= campground.title %>
                            </h5>
                            <p class="card-text">
                                <%= campground.description.substring(0, 220) %>....
                            </p>
                            <p class="card-text">
                                <small class="text-muted">
                                    <%= campground.location %>
                                </small>
                            </p>
                            <a class="btn btn-primary" href="/campgrounds/<%= campground._id %>">View <%=
                                    campground.title %></a>
                        </div>
                    </div>
                </div>
            </div>
            <% } %>

<!-- Page Navigation -->
<nav aria-label="Page navigation" class="pages">
    <% if (pages && pages > 0) { %>
    <ul class="pagination justify-content-center">
        <% if (current == 1) { %>
        <li class="page-item disabled"><a class="page-link">First</a></li>
        <% } else { %>
        <li><a class="page-link" href="/campgrounds">First</a></li>
        <% } %>
 
        <% if (current == 1) { %>
        <li class="page-item disabled"><a class="page-link">«</a></li>
        <% } else { %>
        <li><a class="page-link" href="/campgrounds?page=<%= Number(current) - 1 %>">«</a></li>
        <% } %>
 
        <% var i = (Number(current) > 5 ? Number(current) - 4 : 1) %>
        <% if (i !== 1) { %>
        <li class="page-item disabled"><a class="page-link">...</a></li>
        <% } %>
        <% for (; i <= (Number(current) + 4) && i <= pages; i++) { %>
        <% if (i == current) { %>
        <li class="active"><a class="page-link"><%= i %></a></li>
        <% } else { %>
        <li><a class="page-link" href="/campgrounds?page=<%= i %>"><%= i %></a></li>
        <% } %>
        <% if (i == Number(current) + 4 && i < pages) { %>
        <li class="page-item disabled"><a class="page-link">...</a></li>
        <% } %>
        <% } %>
 
        <% if (current == pages) { %>
        <li class="page-item disabled"><a class="page-link">»</a></li>
        <% } else { %>
        <li><a class="page-link" href="/campgrounds?page=<%= Number(current) + 1 %>">»</a></li>
        <% } %>
 
        <% if (current == pages) { %>
        <li class="page-item disabled"><a class="page-link">Last</a></li>
        <% } else { %>
        <li><a class="page-link" href="/campgrounds?page=<%= pages %>">Last</a></li>
        <% } %>
    </ul>
    <% } %>
</nav>
</div>




<script>
    const mapToken = '<%-process.env.MAPBOX_TOKEN%>';
    const campgrounds = {features: <%- JSON.stringify(campgrounds) %>};
  </script>

<script src="/javascripts/clusterMap.js"></script>

